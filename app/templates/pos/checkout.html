{% extends "base.html" %}
{% block title %}Checkout{% endblock %}
{% block content %}
<div class="page-header d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
  <h1 class="h4 mb-0"><i class="bi bi-credit-card me-2"></i>Checkout</h1>
  <a href="{{ url_for('pos.index') }}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left me-1"></i>Back to POS</a>
</div>
<div class="row g-3">
  <div class="col-md-6">
    <div class="card h-100">
      <div class="card-header">Order summary</div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-sm align-middle mb-0">
            <thead class="table-light"><tr><th>Item</th><th>Qty</th><th>Price</th><th>Subtotal</th></tr></thead>
            <tbody>{% for item in cart %}<tr><td><strong>{{ item.name }}</strong></td><td>{{ item.quantity }}</td><td>{{ item.price }}</td><td>{{ item.subtotal }}</td></tr>{% endfor %}</tbody>
          </table>
        </div>
        <div class="p-3 border-top"><strong>Subtotal:</strong> {{ totals.subtotal }} · <strong>Tax:</strong> {{ totals.tax_amount }} · <strong>Total:</strong> {{ totals.total }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <form method="post" class="card p-4">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <div class="mb-3">
        <label for="payment_method" class="form-label fw-medium">Payment method *</label>
        <select class="form-select rounded-3" id="payment_method" name="payment_method" required>
          <option value="cash">Cash</option>
          <option value="card">Credit/Debit card</option>
          <option value="mobile">Mobile payment</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="customer_id" class="form-label fw-medium">Customer (optional)</label>
        <select class="form-select rounded-3" id="customer_id" name="customer_id">
          <option value="">—</option>
          {% for c in customers %}<option value="{{ c.id }}">{{ c.name }} ({{ c.loyalty_points }} pts)</option>{% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label for="discount_amount" class="form-label fw-medium">Discount amount</label>
        <input type="number" step="0.01" class="form-control rounded-3" id="discount_amount" name="discount_amount" value="0">
      </div>
      <div class="mb-3">
        <label for="promotion_id" class="form-label fw-medium">Promotion</label>
        <select class="form-select rounded-3" id="promotion_id" name="promotion_id">
          <option value="">—</option>
          {% for p in promotions %}<option value="{{ p.id }}">{{ p.name }} ({{ p.promo_type }} {{ p.value }})</option>{% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label for="loyalty_points_used" class="form-label fw-medium">Loyalty points to use</label>
        <input type="number" class="form-control rounded-3" id="loyalty_points_used" name="loyalty_points_used" value="0">
      </div>
      <button type="submit" class="btn btn-success w-100 rounded-3"><i class="bi bi-check-lg me-2"></i>Complete sale</button>
    </form>
  </div>
</div>
{% endblock %}
